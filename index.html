<!DOCTYPE html>
<html lang="do">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deudores - Iniciar Sesión</title>
    <!-- Google Fonts para un look más moderno -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Referencia al archivo de estilos CSS -->
    <link rel="stylesheet" href="estiloh.css">
</head>
<body>

    <!-- Contenedor Principal que se mostrará al cargar -->
    <main id="main-container">
        <div class="login-container">
            <div class="login-box">
                <h1 class="title">Deudores</h1>
                <!-- Formulario de Login -->
                <form id="login-form">
                    <div class="input-group">
                        <label for="username">Nombre de Usuario</label>
                        <input type="text" id="username" name="username" required>
                    </div>
                    <div class="input-group">
                        <label for="role">Tipo de Usuario</label>
                        <select id="role" name="role">
                            <option value="cliente">Cliente</option>
                            <option value="cobrador">Cobrador</option>
                            <option value="administrador">Administrador</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label for="password">Contraseña</label>
                        <input type="password" id="password" name="password" required>
                    </div>
                    <!-- Mensaje de error (inicialmente oculto) -->
                    <p id="error-message" class="error-message"></p>
                    <button type="submit" class="login-button">Entrar</button>
                </form>
            </div>

            <div class="info-container">
                <div class="info-box dollar-rate">
                    <h2>Tasa del Dólar (USD a DOP)</h2>
                    <p class="rate">58.75</p>
                    <small>Ejemplo</small>
                </div>
                <div class="info-box weather">
                    <h2>Clima en Santo Domingo</h2>
                    <p class="temperature">28°C</p>
                    <p class="condition">Parcialmente Nublado</p>
                    <small>Ejemplo</small>
                </div>
            </div>
        </div>
    </main>

    <!-- Vista del Dashboard del Cliente (inicialmente oculta) -->
    <section id="client-dashboard" class="dashboard hidden">
        <div class="dashboard-header">
            <h1 id="client-welcome"></h1>
            <button class="logout-button">Cerrar Sesión</button>
        </div>
        <div class="dashboard-content-grid">
             <div class="main-content-area">
                <div class="card">
                    <h3>Estado de Cuenta</h3>
                    <div id="late-fee-warning" class="late-warning hidden">
                        <p><strong>¡Atención!</strong> Su pago está atrasado.</p>
                    </div>
                    <p><strong>Monto Total Adeudado:</strong> RD$ <span id="total-debt"></span></p>
                    <p><strong>Total de Pagos Realizados:</strong> RD$ <span id="payments-made"></span></p>
                    <p class="balance"><strong>Balance Pendiente:</strong> RD$ <span id="current-balance"></span></p>
                </div>
                <div class="card">
                    <h3>Historial de Transacciones</h3>
                    <div id="payment-history-container"></div>
                </div>
            </div>
            <div class="sidebar-area">
                <div class="card">
                    <h3>Información del Perfil</h3>
                    <p><strong>Dirección:</strong> <span id="client-address"></span></p>
                    <p><strong>Contacto:</strong> <span id="client-contact"></span></p>
                    <p><strong>Cédula:</strong> <span id="client-id"></span></p>
                </div>
                 <div id="client-plan-card" class="card hidden">
                    <h3>Mi Plan de Pago</h3>
                    <p><strong>Frecuencia:</strong> <span id="plan-frequency"></span></p>
                    <p><strong>Monto por Cuota:</strong> RD$ <span id="plan-amount"></span></p>
                    <p><strong>Próximo Vencimiento:</strong> <span id="plan-due-date"></span></p>
                </div>
            </div>
        </div>
    </section>

    <!-- Vista del Dashboard del Administrador (inicialmente oculta) -->
    <section id="admin-dashboard" class="dashboard hidden">
        <div class="dashboard-header">
            <h1>Panel de Administración</h1>
            <button class="logout-button">Cerrar Sesión</button>
        </div>
        <div class="dashboard-content">
            <div class="card">
                <h3>Pagos Pendientes de Aprobación</h3>
                <div id="pending-payments-container"></div>
            </div>
            <div class="card">
                <h3>Gestión de Usuarios</h3>
                <div class="admin-actions">
                    <p>Gestiona clientes existentes o añade un nuevo usuario.</p>
                    <button id="create-user-button" class="button-new-client">Crear Nuevo Usuario</button>
                </div>
                <div id="client-list-container"></div>
            </div>
        </div>
    </section>
    
    <!-- Vista del Dashboard del Cobrador (inicialmente oculta) -->
    <section id="collector-dashboard" class="dashboard hidden">
        <div class="dashboard-header">
            <h1 id="collector-welcome"></h1>
            <button class="logout-button">Cerrar Sesión</button>
        </div>
        <div class="dashboard-content">
            <div class="card">
                <h3>Registrar Pagos de Clientes</h3>
                <p>Seleccione un cliente para registrar un pago.</p>
                <div id="collector-client-list-container"></div>
            </div>
        </div>
    </section>

    <!-- Modal para gestionar cliente (Admin) -->
    <div id="manage-client-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-client-name"></h2>
                <button class="close-modal-button">&times;</button>
            </div>
            <div class="modal-body">
                <form id="manage-client-form">
                    <div class="input-group">
                        <label for="new-payment">Registrar Nuevo Pago (Aprobado)</label>
                        <input type="number" id="new-payment" placeholder="0.00" min="0">
                    </div>
                    <hr>
                    <div class="input-group">
                        <label for="update-debt">Actualizar Deuda Total (RD$)</label>
                        <input type="number" id="update-debt" placeholder="0.00" min="0">
                    </div>
                    <p class="modal-info">Deja un campo en blanco si no deseas modificarlo.</p>
                    <button type="submit" class="button-primary">Guardar Cambios</button>
                </form>
                <div id="late-fee-section" class="late-fee-section hidden">
                    <hr>
                    <p>El cliente está atrasado. Puede aplicar el cargo por mora.</p>
                    <button id="apply-late-fee-button" class="button-danger">Aplicar Cargo por Mora</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para registrar pago (Cobrador) -->
    <div id="register-payment-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="register-payment-client-name"></h2>
                <button class="close-modal-button">&times;</button>
            </div>
            <div class="modal-body">
                <form id="register-payment-form">
                    <div class="input-group">
                        <label for="collector-payment-amount">Monto del Pago (RD$)</label>
                        <input type="number" id="collector-payment-amount" placeholder="0.00" min="1" required>
                    </div>
                    <button type="submit" class="button-primary">Registrar Pago</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal para crear usuario (Admin) -->
    <div id="create-user-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Crear Nuevo Usuario</h2>
                <button class="close-modal-button">&times;</button>
            </div>
            <div class="modal-body">
                <form id="create-user-form">
                    <div class="input-group">
                        <label for="new-user-role">Tipo de Usuario</label>
                        <select id="new-user-role" required>
                            <option value="cliente">Cliente</option>
                            <option value="cobrador">Cobrador</option>
                        </select>
                    </div>
                    <hr>
                    <h4>Datos Personales y Credenciales</h4>
                    <div class="input-group">
                        <label for="new-fullname">Nombre Completo</label>
                        <input type="text" id="new-fullname" required>
                    </div>
                    <div class="input-group">
                        <label for="new-username">Nombre de Usuario</label>
                        <input type="text" id="new-username" required>
                    </div>
                    <div class="input-group">
                        <label for="new-password">Contraseña</label>
                        <input type="password" id="new-password" required>
                    </div>
                    <div id="client-specific-fields">
                        <div class="input-group">
                            <label for="new-address">Dirección</label>
                            <input type="text" id="new-address">
                        </div>
                        <div class="input-group">
                            <label for="new-contact">Contacto</label>
                            <input type="text" id="new-contact">
                        </div>
                        <div class="input-group">
                            <label for="new-idnumber">Cédula</label>
                            <input type="text" id="new-idnumber">
                        </div>
                        <hr>
                        <h4>Condiciones del Préstamo</h4>
                        <div class="input-group">
                            <label for="initial-debt">Deuda Inicial (RD$)</label>
                            <input type="number" id="initial-debt" min="1" required>
                        </div>
                        <div class="input-group">
                            <label for="loan-term">Plazo del Préstamo (meses)</label>
                            <input type="number" id="loan-term" min="1" required>
                        </div>
                        <div class="input-group">
                            <label for="interest-rate">Tasa de Interés Mensual (%)</label>
                            <input type="number" id="interest-rate" min="0" step="0.1" required>
                        </div>
                        <div class="input-group">
                            <label for="late-fee-rate">Tasa de Mora Mensual (%)</label>
                            <input type="number" id="late-fee-rate" min="0" step="0.1" required>
                        </div>
                    </div>
                    <p id="create-error-message" class="error-message"></p>
                    <button type="submit" class="button-primary">Siguiente</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal para seleccionar plan de pago -->
    <div id="payment-plan-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Seleccionar Plan de Pago</h2>
                 <button class="close-modal-button">&times;</button>
            </div>
            <div class="modal-body">
                <p>Elija el plan de pago para el nuevo cliente.</p>
                <form id="select-plan-form">
                    <div id="plan-options-container"></div>
                    <p id="plan-error-message" class="error-message"></p>
                    <button type="submit" class="button-primary">Confirmar Plan y Crear Cliente</button>
                </form>
            </div>
        </div>
    </div>

    <script src="scripth.js"></script>
</body>
</html>
